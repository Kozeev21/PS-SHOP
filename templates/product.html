{% extends "base.html" %}
{% block content %}
<div class="product-detail-container">
    {% if product %}
        <div class="product-detail">
            <div class="product-image-container">
                <img id="main-product-image" src="{{ product.img_url }}" alt="{{ product.name }}" class="product-detail-image">
                
                <div class="image-switcher" style="display: flex; gap: 10px; margin-top: 15px; justify-content: center;">
                    <button id="show-first-image" class="image-switch-btn active" 
                            onclick="switchProductImage('{{ product.img_url }}', this)"
                            style="padding: 8px 15px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        –§–æ—Ç–æ 1
                    </button>
                    
                    {% if product.img_url2 %}
                    <button id="show-second-image" class="image-switch-btn" 
                            onclick="switchProductImage('{{ product.img_url2 }}', this)"
                            style="padding: 8px 15px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        –§–æ—Ç–æ 2
                    </button>
                    {% endif %}
                </div>
            </div>
            
            <div class="product-info">
                <h1>{{ product.name }}</h1>
                <p class="price">{{ product.price }} ‚ÇΩ</p>
                <p class="description">{{ product.description or '–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞' }}</p>
                
                <div class="quantity-control">
                    <button class="decrease" onclick="decreaseQuantityForProduct('{{ product.uuid }}')">‚àí</button>
                    <span class="quantity" id="quantity-{{ product.uuid }}">0</span>
                    <button class="increase" onclick="increaseQuantityForProduct('{{ product.uuid }}', '{{ product.name }}')">+</button>
                </div>
                
                <button class="add-to-cart-btn" onclick="addToCartProductPage('{{ product.uuid }}', '{{ product.name }}', '{{ product.price }}', '{{ product.img_url }}')">
                    –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
                </button>
                
                <button onclick="window.location.href='/shop'" class="back-btn">
                    ‚Üê –ù–∞–∑–∞–¥ –≤ –º–∞–≥–∞–∑–∏–Ω
                </button>
            </div>
        </div>
    {% else %}
        <p>–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω</p>
    {% endif %}
</div>
<script>
function updateCartButtonForProduct() {
    let total = 0;
    for (let key in localStorage) {
        if (key.startsWith('product_quantity_')) {
            total += parseInt(localStorage.getItem(key)) || 0;
        }
    }
    
    const cartButtons = document.querySelectorAll('[id^="cart-button"], .cart-button');
    cartButtons.forEach(button => {
        if (button) {
            button.textContent = total === 0 ? 'üõí –ö–æ—Ä–∑–∏–Ω–∞' : `üõí –ö–æ—Ä–∑–∏–Ω–∞ (${total})`;
        }
    });
}

function increaseQuantityForProduct(productId, productName) {
    let quantity = parseInt(localStorage.getItem(`product_quantity_${productId}`)) || 0;
    quantity += 1;
    localStorage.setItem(`product_quantity_${productId}`, quantity);
    localStorage.setItem(`product_${productId}`, productName);
    document.getElementById(`quantity-${productId}`).textContent = quantity;
    updateCartButton();
}

function decreaseQuantityForProduct(productId) {
    let quantity = parseInt(localStorage.getItem(`product_quantity_${productId}`)) || 0;
    if (quantity > 0) {
        quantity -= 1;
        localStorage.setItem(`product_quantity_${productId}`, quantity);
        document.getElementById(`quantity-${productId}`).textContent = quantity;
        updateCartButton();
    }
}

function addToCartProductPage(productId, productName, productPrice, productImg) {
    increaseQuantityForProduct(productId, productName);
    
    localStorage.setItem(`product_price_${productId}`, productPrice);
    localStorage.setItem(`product_img_${productId}`, productImg);
    
}

function switchProductImage(imageUrl, buttonElement) {
    document.getElementById('main-product-image').src = imageUrl;

    document.querySelectorAll('.image-switch-btn').forEach(btn => {
        btn.classList.remove('active');
        btn.style.background = '#6c757d';
    });

    buttonElement.classList.add('active');
    buttonElement.style.background = '#007bff';
}

document.addEventListener('DOMContentLoaded', function() {
    const productId = '{{ product.uuid }}';
    if (productId) {
        const quantity = parseInt(localStorage.getItem(`product_quantity_${productId}`)) || 0;
        document.getElementById(`quantity-${productId}`).textContent = quantity;
    }
    updateCartButton();
});
</script>
{% endblock %}