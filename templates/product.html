{% extends "base.html" %}
{% block content %}
<div class="product-detail-container">
    {% if product %}
        <div class="product-detail">
            <div class="product-image-container">
                <img src="{{ product.img_url }}" alt="{{ product.name }}" class="product-detail-image">
            </div>
            
            <div class="product-info">
                <h1>{{ product.name }}</h1>
                <p class="price">{{ product.price }} ‚ÇΩ</p>
                <p class="description">{{ product.description or '–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞' }}</p>
                
                <div class="quantity-control">
                    <button class="decrease" onclick="decreaseQuantity('{{ product.uuid }}')">‚àí</button>
                    <span class="quantity" id="quantity-{{ product.uuid }}">0</span>
                    <button class="increase" onclick="increaseQuantity('{{ product.uuid }}', '{{ product.name }}')">+</button>
                </div>
                
                <!--<button class="add-to-cart-btn" onclick="addToCartProductPage('{{ product.uuid }}', '{{ product.name }}', '{{ product.price }}', '{{ product.img_url }}')">
                    –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
                </button>-->
                
                <button onclick="window.location.href='/shop'" class="back-btn">
                    ‚Üê –ù–∞–∑–∞–¥ –≤ –º–∞–≥–∞–∑–∏–Ω
                </button>
            </div>
        </div>
    {% else %}
        <p>–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω</p>
    {% endif %}
</div>

<script>
// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã
function updateCartButton() {
    let total = 0;
    for (let key in localStorage) {
        if (key.startsWith('product_quantity_')) {
            total += parseInt(localStorage.getItem(key)) || 0;
        }
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    const cartButtons = document.querySelectorAll('[id^="cart-button"], .cart-button');
    cartButtons.forEach(button => {
        if (button) {
            button.textContent = total === 0 ? 'üõí –ö–æ—Ä–∑–∏–Ω–∞' : `üõí –ö–æ—Ä–∑–∏–Ω–∞ (${total})`;
        }
    });
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º
function increaseQuantity(productId, productName) {
    let quantity = parseInt(localStorage.getItem(`product_quantity_${productId}`)) || 0;
    quantity += 1;
    localStorage.setItem(`product_quantity_${productId}`, quantity);
    localStorage.setItem(`product_${productId}`, productName);
    document.getElementById(`quantity-${productId}`).textContent = quantity;
    updateCartButton();
}

function decreaseQuantity(productId) {
    let quantity = parseInt(localStorage.getItem(`product_quantity_${productId}`)) || 0;
    if (quantity > 0) {
        quantity -= 1;
        localStorage.setItem(`product_quantity_${productId}`, quantity);
        document.getElementById(`quantity-${productId}`).textContent = quantity;
        updateCartButton();
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞
function addToCartProductPage(productId, productName, productPrice, productImg) {
    increaseQuantity(productId, productName);
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ü–µ–Ω–∞ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ)
    localStorage.setItem(`product_price_${productId}`, productPrice);
    localStorage.setItem(`product_img_${productId}`, productImg);
    
    alert('–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!');
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    const productId = '{{ product.uuid }}';
    if (productId) {
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑ localStorage
        const quantity = parseInt(localStorage.getItem(`product_quantity_${productId}`)) || 0;
        document.getElementById(`quantity-${productId}`).textContent = quantity;
    }
    updateCartButton();
});
</script>
{% endblock %}