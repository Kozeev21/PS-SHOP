{% extends "base.html" %}
{% block content %}
<div style="max-width: 1000px; margin: 30px auto; padding: 0 20px;">
    <h1 style="text-align: center; margin-bottom: 30px;">üõí –ú–æ—è –∫–æ—Ä–∑–∏–Ω–∞</h1>
    
    <div id="cart-content">
        <div style="text-align: center; padding: 40px;">
            <p style="font-size: 18px;">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã...</p>
        </div>
    </div>
    
    <div id="empty-cart" style="display: none; text-align: center; padding: 50px;">
        <h2 style="color: #666;">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</h2>
        <p style="margin: 20px 0;">–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –º–∞–≥–∞–∑–∏–Ω–∞!</p>
        <button onclick="window.location.href='/shop'" 
                style="padding: 12px 30px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;">
            –ü–µ—Ä–µ–π—Ç–∏ –≤ –º–∞–≥–∞–∑–∏–Ω
        </button>
    </div>
    
    <div id="cart-summary" style="display: none; background: #f8f9fa; padding: 25px; border-radius: 10px; margin-top: 30px;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h3 style="margin: 0;">–ò—Ç–æ–≥–æ:</h3>
                <p style="margin: 5px 0; color: #666;" id="total-items">0 —Ç–æ–≤–∞—Ä–æ–≤</p>
            </div>
            <div style="text-align: right;">
                <div style="font-size: 28px; font-weight: bold; color: #007bff;" id="total-price">0 ‚ÇΩ</div>
                <p style="margin: 5px 0; color: #666; font-size: 14px;">–î–æ—Å—Ç–∞–≤–∫–∞: —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏</p>
            </div>
        </div>
        
        <div style="display: flex; gap: 15px; margin-top: 25px;">
            <button onclick="clearCart()" 
                    style="flex: 1; padding: 15px; background: #dc3545; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px;">
                –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É
            </button>
            
            <button onclick="window.location.href='/checkout'" 
                    style="flex: 2; padding: 15px; background: #28a745; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 18px; font-weight: bold;">
                –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
            </button>
        </div>
    </div>
</div>

<script>
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã –∏–∑ localStorage
function loadCart() {
    const cartItems = [];
    let totalPrice = 0;
    let totalItems = 0;
    
    for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        
        if (key.startsWith('product_quantity_')) {
            const productId = key.replace('product_quantity_', '');
            const quantity = parseInt(localStorage.getItem(key)) || 0;
            
            if (quantity > 0) {
                const productName = localStorage.getItem(`product_${productId}`) || `–¢–æ–≤–∞—Ä ${productId}`;
                const productPrice = parseFloat(localStorage.getItem(`product_price_${productId}`)) || 0;
                const productImg = localStorage.getItem(`product_img_${productId}`) || 'https://via.placeholder.com/100x100/cccccc/666666?text=No+Image';
                
                const itemTotal = productPrice * quantity;
                totalPrice += itemTotal;
                totalItems += quantity;
                
                cartItems.push({
                    id: productId,
                    name: productName,
                    price: productPrice,
                    quantity: quantity,
                    img: productImg,
                    total: itemTotal
                });
            }
        }
    }
    
    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É
    const cartContent = document.getElementById('cart-content');
    const emptyCart = document.getElementById('empty-cart');
    const cartSummary = document.getElementById('cart-summary');
    
    if (cartItems.length === 0) {
        cartContent.style.display = 'none';
        emptyCart.style.display = 'block';
        cartSummary.style.display = 'none';
    } else {
        emptyCart.style.display = 'none';
        cartSummary.style.display = 'block';
        
        let html = '<div style="display: flex; flex-direction: column; gap: 20px;">';
        
        cartItems.forEach(item => {
            html += `
            <div style="display: flex; align-items: center; gap: 20px; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                <img src="${item.img}" alt="${item.name}" style="width: 100px; height: 100px; object-fit: cover; border-radius: 8px;">
                
                <div style="flex: 1;">
                    <h3 style="margin: 0 0 10px 0;">${item.name}</h3>
                    <div style="font-size: 20px; font-weight: bold; color: #007bff;">${item.price} ‚ÇΩ</div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                    <div style="display: flex; align-items: center; gap: 10px; background: #f8f9fa; padding: 10px; border-radius: 8px;">
                        <button onclick="updateQuantity('${item.id}', -1)" 
                                style="width: 40px; height: 40px; background: #f0f0f0; border: 1px solid #ccc; border-radius: 5px; cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center;">-</button>
                        
                        <span style="font-size: 20px; font-weight: bold; min-width: 40px; text-align: center;">${item.quantity}</span>
                        
                        <button onclick="updateQuantity('${item.id}', 1)" 
                                style="width: 40px; height: 40px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center;">+</button>
                    </div>
                    
                    <div style="font-size: 22px; font-weight: bold; min-width: 120px; text-align: right;">
                        ${item.total} ‚ÇΩ
                    </div>
                    
                    <button onclick="removeFromCart('${item.id}')" 
                            style="padding: 10px 15px; background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">
                        –£–¥–∞–ª–∏—Ç—å
                    </button>
                </div>
            </div>
            `;
        });
        
        html += '</div>';
        cartContent.innerHTML = html;
        cartContent.style.display = 'block';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏—Ç–æ–≥–∏
        document.getElementById('total-price').textContent = totalPrice.toFixed(0) + ' ‚ÇΩ';
        document.getElementById('total-items').textContent = totalItems + ' —Ç–æ–≤–∞—Ä' + (totalItems !== 1 ? '–∞' : '');
    }
}

// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
function updateQuantity(productId, change) {
    const currentKey = `product_quantity_${productId}`;
    let quantity = parseInt(localStorage.getItem(currentKey)) || 0;
    
    quantity += change;
    
    if (quantity < 0) quantity = 0;
    
    if (quantity === 0) {
        localStorage.removeItem(currentKey);
        localStorage.removeItem(`product_${productId}`);
        localStorage.removeItem(`product_price_${productId}`);
        localStorage.removeItem(`product_img_${productId}`);
    } else {
        localStorage.setItem(currentKey, quantity);
    }
    
    loadCart();
    updateCartButton(); 
}

function removeFromCart(productId) {
    if (confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã?')) {
        localStorage.removeItem(`product_quantity_${productId}`);
        localStorage.removeItem(`product_${productId}`);
        localStorage.removeItem(`product_price_${productId}`);
        localStorage.removeItem(`product_img_${productId}`);
        
        loadCart();
        updateCartButton();
    }
}

function clearCart() {
    if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∫–æ—Ä–∑–∏–Ω—É?')) {
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key.startsWith('product_')) {
                localStorage.removeItem(key);
                i--;
            }
        }
        window.location.reload();
    }
}

function updateCartButton() {
    let total = 0;
    for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith('product_quantity_')) {
            total += parseInt(localStorage.getItem(key)) || 0;
        }
    }
    
    const cartButton = document.getElementById('cart-button');
    if (cartButton) {
        cartButton.textContent = total === 0 ? 'üõí –ö–æ—Ä–∑–∏–Ω–∞' : `üõí –ö–æ—Ä–∑–∏–Ω–∞ (${total})`;
    }
}

document.addEventListener('DOMContentLoaded', function() {
    loadCart();
    updateCartButton();
});
</script>
{% endblock %}