<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#667eea">
    <title>–ú–∞–≥–∞–∑–∏–Ω –æ–¥–µ–∂–¥—ã</title>
    <!-- –ü–†–ê–í–ò–õ–¨–ù–´–ô –ü–£–¢–¨ –ö CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        /* –ò–Ω–ª–∞–π–Ω —Å—Ç–∏–ª–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ */
        .mobile-only { display: none; }
        @media (max-width: 768px) {
            .desktop-only { display: none !important; }
            .mobile-only { display: block !important; }
        }
    </style>
</head>
<body>
    <div id="top-bar">
        <div id="menu">
            <button class="main-page" onclick="window.location.href='/'">–ì–ª–∞–≤–Ω–∞—è</button>
            <button class="shop-page" onclick="window.location.href='/shop'">–ú–∞–≥–∞–∑–∏–Ω</button>
            <button class="about-page desktop-only" onclick="window.location.href='/about'">–û –Ω–∞—Å</button>
        </div>
        
        <div id="user-section">
            {% if session.get('user_id') %}
                <span style="margin-right: 10px; font-size: 14px;" class="desktop-only">
                    –ü—Ä–∏–≤–µ—Ç, {{ session.get('user_name', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å') }}!
                </span>
                <button onclick="window.location.href='/profile'" style="margin-right: 5px; background-color: #007bff; color: white; padding: 8px 12px; border-radius: 4px; border: none; cursor: pointer; font-size: 14px;">
                    –ü—Ä–æ—Ñ–∏–ª—å
                </button>
                <button onclick="window.location.href='/logout'" style="background-color: #dc3545; color: white; padding: 8px 12px; border-radius: 4px; border: none; cursor: pointer; font-size: 14px;">
                    –í—ã–π—Ç–∏
                </button>
            {% else %}
                <button onclick="window.location.href='/login'" style="margin-right: 5px; background-color: #007bff; color: white; padding: 8px 12px; border-radius: 4px; border: none; cursor: pointer; font-size: 14px;">
                    –í–æ–π—Ç–∏
                </button>
                <button onclick="window.location.href='/register'" style="background-color: #28a745; color: white; padding: 8px 12px; border-radius: 4px; border: none; cursor: pointer; font-size: 14px;">
                    –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
                </button>
            {% endif %}
        </div>
    </div>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-messages">
                {% for category, message in messages %}
                    <div class="flash {{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}
    
    <!-- –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) -->
    <div class="mobile-only" style="display: none; padding: 10px; background: #f8f9fa; text-align: center;">
        <button onclick="window.location.href='/about'" style="margin: 0 5px; padding: 8px 12px; background: #6c757d; color: white; border: none; border-radius: 4px;">
            –û –Ω–∞—Å
        </button>
        {% if session.get('user_id') %}
            <span style="margin: 0 10px; font-size: 14px;">
                {{ session.get('user_name', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å') }}
            </span>
        {% endif %}
    </div>
    
    {% block content %}{% endblock %}
    
    <!-- –ú–æ–±–∏–ª—å–Ω—ã–π —Ñ—É—Ç–µ—Ä -->
    <div class="mobile-only" style="position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top: 1px solid #ddd; padding: 10px; display: flex; justify-content: space-around; z-index: 1000;">
        <button onclick="window.location.href='/'" style="background: none; border: none; font-size: 24px;">üè†</button>
        <button onclick="window.location.href='/shop'" style="background: none; border: none; font-size: 24px;">üõçÔ∏è</button>
        <button onclick="window.location.href='/cart'" style="background: none; border: none; font-size: 24px;">üõí</button>
        <button onclick="window.location.href='/profile'" style="background: none; border: none; font-size: 24px;">üë§</button>
    </div>
    
    <script>
        // –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π JS
        document.addEventListener('DOMContentLoaded', function() {
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            
            if (isMobile) {
                document.body.classList.add('mobile-device');
                
                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ç–∞—á-—Ç–∞—Ä–≥–µ—Ç—ã
                document.querySelectorAll('button, a').forEach(el => {
                    el.style.minHeight = '44px';
                    el.style.minWidth = '44px';
                });
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é
                document.querySelectorAll('.mobile-only').forEach(el => {
                    el.style.display = 'block';
                });
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –∫–æ—Ä–∑–∏–Ω—ã –¥–ª—è –º–æ–±–∏–ª–æ–∫
            function updateMobileCartButton() {
                let total = 0;
                for (let key in localStorage) {
                    if (key.startsWith('product_quantity_')) {
                        total += parseInt(localStorage.getItem(key)) || 0;
                    }
                }
                
                const mobileCartBtn = document.querySelector('[onclick*="cart"]');
                if (mobileCartBtn && total > 0) {
                    mobileCartBtn.innerHTML = `üõí<span style="position: absolute; top: -5px; right: -5px; background: red; color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 12px; display: flex; align-items: center; justify-content: center;">${total}</span>`;
                }
            }
            
            updateMobileCartButton();
        });
    </script>
</body>
</html>